<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: CONTRIBUTING
  
    &mdash; Documentation by YARD 0.9.8
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "CONTRIBUTING";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: CONTRIBUTING</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1>Contribution Guide</h1>

<p>Thank you for your interest in contributing to the Cloud Stove. Please note that the project adheres to the Contributor Covenant <a href="file.CODE_OF_CONDUCT.html" title="code of conduct">code of conduct</a>. By participating in this project you are expected to uphold its terms.</p>

<p>Currently, the Cloud Stove is split across two repositories: the backend Rails app, and the frontend AngularJS application. This guide focuses on the backend Rails app.</p>

<h2>Setting Up a Development Environment</h2>

<ul>
<li><p>Clone the Cloud Stove repository</p>

<pre class="code shell"><code class="shell">git clone git@github.com:sealuzh/cloud-stove.git
cd cloud-stove
</code></pre></li>
<li><p>Install an appropriate Ruby version (the currently required version is specified in <a href=".ruby-version">.ruby-version</a>). Install Ruby using <a href="http://rbenv.org">rbenv</a> or <a href="https://rvm.io">RVM</a>.</p>

<ul>
<li>If you&#39;re using rbenv, run  <code>rbenv install $(cat .ruby-version)</code>.</li>
<li>For RVM, run <code>rvm install $(cat .ruby-version)</code>.</li>
</ul></li>
<li><p>Install <code>phantomjs</code> for headless UI tests (integration tests fail without phantomjs): <a href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a></p>

<p>macOS:</p>

<pre class="code shell"><code class="shell">brew install phantomjs
</code></pre>

<p>Linux:</p>

<pre class="code shell"><code class="shell">export PHANTOMJS_FILE=phantomjs-2.1.1-linux-x86_64
export PHANTOMJS_URL=https://bitbucket.org/ariya/phantomjs/downloads/$PHANTOMJS_FILE.tar.bz2
export PHANTOMJS_DIR=/usr/local/share
curl -sSL $PHANTOMJS_URL | tar -xj -C $PHANTOMJS_DIR
ln -s $PHANTOMJS_DIR/$PHANTOMJS_FILE/bin/phantomjs /usr/local/bin/phantomjs
</code></pre></li>
<li><p>Set up dependencies and database for the Rails app:</p>

<pre class="code shell"><code class="shell">bin/setup
</code></pre></li>
<li><p>Install the <a href="https://github.com/inz/minizinc-dist/releases">or-tools MiniZinc distribution</a>. There are pre-packaged binaries for macOS, Linux, and Windows (64 bit):</p>

<p>macOS:</p>

<pre class="code shell"><code class="shell">curl -sSL https://github.com/inz/minizinc-dist/releases/download/minizinc-2.0.13_or-tools-v2016-06/minizinc-2.0.13_or-tools-v2016-06-darwin-vendor.tar.gz | tar xz -
</code></pre>

<p>Linux:</p>

<pre class="code shell"><code class="shell">curl -sSL https://github.com/inz/minizinc-dist/releases/download/minizinc-2.0.13_or-tools-v2016-06/minizinc-2.0.13_or-tools-v2016-06-linux64-vendor.tar.gz | tar -xz
</code></pre>

<p>Windows (64 bit only):</p>

<pre class="code shell"><code class="shell">curl -sSL https://github.com/inz/minizinc-dist/releases/download/minizinc-2.0.13_or-tools-v2016-06/minizinc-2.0.13_or-tools-v2016-06-win64-vendor.tar.gz | tar xz -
</code></pre>

<p>Add <code>vendor/minizinc/bin</code> to your <code>PATH</code>:</p>

<pre class="code shell"><code class="shell">export PATH=$PWD/vendor/minizinc/bin:$PATH
</code></pre></li>
<li><p>Start the Rails server and job worker</p>

<pre class="code shell"><code class="shell"># Start the app server
rails s -p 5000
# In another terminal, start the worker job
rake jobs:work

# Alternatively, you can launch both simultaneously using foreman
gem install foreman
foreman start
</code></pre></li>
<li><p>You should now be able to access the backend at http://localhost:5000</p></li>
<li><p>To set up the front check out the front end <a href="https://github.com/sealuzh/cloud-stove-ui/blob/master/CONTRIBUTING.md">contribution guide</a></p></li>
</ul>

<h2>Run Development Environment with Docker</h2>

<ol>
<li><p>Build the image</p>

<pre class="code shell"><code class="shell">docker build -t cloud-stove .
</code></pre></li>
<li><p>Start the container</p>

<pre class="code shell"><code class="shell">docker run -p 3000:3000 cloud-stove
</code></pre></li>
<li><p>Login with an interactive shell</p>

<pre class="code shell"><code class="shell">docker run --rm -it cloud-stove /bin/bash
</code></pre></li>
</ol>

<h2>Making Changes</h2>

<ul>
<li><p><a href="https://github.com/sealuzh/cloud-stove/fork">Fork</a> the project</p></li>
<li><p>Pick a story from the backlog in the <a href="https://github.com/sealuzh/cloud-stove/issues">List of issues</a> and assign it to yourself.</p></li>
<li><p>Create a topic branch for your changes.</p>

<pre class="code shell"><code class="shell">git checkout -b &lt;feature/my-awesome-feature&gt;
</code></pre>

<p>Namespaces: <code>feature/*</code>, <code>fix/*</code>, <code>hotfix/*</code>, <code>support/*</code></p></li>
<li><p>Make your change. Add tests for your change. Make the tests pass:</p>

<pre class="code shell"><code class="shell">bundle exec rake test
</code></pre>

<ul>
<li>If tests fail with <code>sh: minizinc: command not found</code> make sure that your
<em>or-tools</em> MiniZinc installation is in your <code>PATH</code>. If your <code>PATH</code> is set correctly
and you still get the error, make sure that <code>spring</code> starts with the correct <code>PATH</code>:</li>
</ul>

<pre class="code ruby"><code class="ruby">bin/spring stop
PATH=vendor/minizinc/bin/:$PATH bundle exec rake test
</code></pre>

<p>This should set the correct environment for the newly started <code>spring</code> process.</p>

<ul>
<li>If tests fail with <code>Cannot access include directory .../share/minizinc/or-tools/</code>, make sure that the first MiniZinc binary in the <code>PATH</code> points to the <em>or-tools</em> distribution and not to any other MiniZinc implementation.</li>
<li>The wiki has further <a href="https://github.com/sealuzh/cloud-stove/wiki#troubleshooting">troubleshooting tips</a>.</li>
</ul></li>
<li><p>Make sure that your code always has good test coverage.</p></li>
<li><p>Push your topic branch and <a href="https://github.com/sealuzh/cloud-stove/compare">submit a pull request</a>. To keep our project history clean, always rebase your changes onto master.</p></li>
</ul>

<p>You should also periodically push your topic branches during development. That
way, there will always be a reasonably current backup of your work in the
upstream repository, and the whole team can get a feel on what others are
working on.</p>

<h3>Gemfile on Windows</h3>

<p>Heroku ignores Gemfiles that are created on Windows. This might lead to unpredictable build failures. So far, we only committed <code>Gemfile.lock</code> changes on non-Windows machines. Refer to <a href="https://devcenter.heroku.com/articles/bundler-windows-gemfile">Heroku Dev Center</a> for other options how to mitigate this problem.</p>

<h2>Tips and Tricks</h2>

<ul>
<li><p>Continuous test execution and live reload:</p>

<pre class="code shell"><code class="shell">bundle exec guard
</code></pre>

<ul>
<li>Automatically runs affected tests on file edit. Type <code>all</code> to manually run all tests.</li>
<li>Automatically reloads a page on asset modification via the following browser plugin: <a href="http://livereload.com/extensions/">http://livereload.com/extensions/</a></li>
</ul></li>
<li><p>Lint factories</p>

<pre class="code shell"><code class="shell">rake factory_girl:lint
</code></pre></li>
<li><p>Test Wercker CI build locally</p>

<pre class="code shell"><code class="shell">wercker build
</code></pre>

<ul>
<li>Requires wercker CLI: <a href="http://wercker.com/cli/">http://wercker.com/cli/</a></li>
<li>Use <code>--attach-on-error</code> to debug failing builds</li>
<li>Use <code>--docker-local</code> to use locally cached containers</li>
</ul></li>
</ul>

<h2>Writing Tests</h2>

<h3>Authentication</h3>

<ul>
<li>Controller tests using <code>ActionController::TestCase</code> automatically create the <code>@user</code> and
set the authentication headers for each request</li>
<li>Integration tests can use the <code>sign_in(user)</code> helper method</li>
</ul>

<h3>Controller Tests</h3>

<ul>
<li><p>Access response as parsed JSON (e.g., <code>json_response[&#39;num_simultaneous_users&#39;]</code>)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_json_response'>json_response</span>
</code></pre></li>
</ul>

<h3>Integration Tests</h3>

<ul>
<li><p>Login a certain user:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sign_in'>sign_in</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
</code></pre></li>
<li><p>Save a snapshot of the page during an integration test:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_show_page'>show_page</span>
</code></pre>

<p>This will even sideload assets if a Rails server is running.</p></li>
<li><p>Reload the current page:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_reload_page'>reload_page</span><span class='lparen'>(</span><span class='id identifier rubyid_page'>page</span><span class='rparen'>)</span>
</code></pre></li>
</ul>
</div></div>

      <div id="footer">
  Generated on Thu Mar  2 15:02:21 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.8 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>